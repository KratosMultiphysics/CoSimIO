name: Update version after master was modified

# on:
#   push:
#     branches:
#       - 'master'

on: push
jobs:
  update-version:
    runs-on: ubuntu-latest
    steps:
      - uses: actions/checkout@v2
      - name: Update Patch Version
        run: |
          branch_name=${GITHUB_REF##*/}
          long_hash=$(git ls-remote git://github.com/KratosMultiphysics/CoSimIO.git refs/heads/${branch_name} | cut -f 1)
          short_hash=$(git rev-parse --short ${long_hash})
          sed -i '/AUTO-GENERATED/c\    \/*AUTO-GENERATED*\/return "${short_hash}";' co_sim_io/impl/version.hpp
          git config --global user.name 'Kratos Multiphysics Bot'
          git config --global user.email 'kratos-multiphysics-bot@users.noreply.github.com'
          git commit -am "update patch version"
          git push
